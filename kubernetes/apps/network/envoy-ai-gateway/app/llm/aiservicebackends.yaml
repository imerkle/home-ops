---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: openai
spec:
  schema:
    name: OpenAI
  backendRef:
    name: openai-backend
    kind: Backend
    group: gateway.envoyproxy.io
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: anthropic
spec:
  schema:
    name: Anthropic
  backendRef:
    name: anthropic-backend
    kind: Backend
    group: gateway.envoyproxy.io
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: google
spec:
  schema:
    name: OpenAI
    prefix: "/v1beta/openai"
  backendRef:
    name: google-backend
    kind: Backend
    group: gateway.envoyproxy.io
---
# TLS policy for HTTPS upstream to GitHub Copilot API
apiVersion: gateway.networking.k8s.io/v1alpha3
kind: BackendTLSPolicy
metadata:
  name: google-tls
spec:
  targetRefs:
    - group: gateway.envoyproxy.io
      kind: Backend
      name: google
  validation:
    wellKnownCACertificates: System
    hostname: generativelanguage.googleapis.com
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: vercel
spec:
  schema:
    name: OpenAI
  backendRef:
    name: vercel-backend
    kind: Backend
    group: gateway.envoyproxy.io
---
# Security Policies for Outbound Authentication
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: openai-auth
spec:
  targetRefs:
    - kind: AIServiceBackend
      group: aigateway.envoyproxy.io
      name: openai
  type: APIKey
  apiKey:
    secretRef:
      name: openai-secret
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: anthropic-auth
spec:
  targetRefs:
    - kind: AIServiceBackend
      group: aigateway.envoyproxy.io
      name: anthropic
  type: AnthropicAPIKey
  anthropicAPIKey:
    secretRef:
      name: anthropic-secret
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: google-auth
spec:
  targetRefs:
    - kind: AIServiceBackend
      group: aigateway.envoyproxy.io
      name: google
  type: APIKey
  apiKey:
    secretRef:
      name: google-secret
---
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: vercel-auth
spec:
  targetRefs:
    - kind: AIServiceBackend
      group: aigateway.envoyproxy.io
      name: vercel
  type: APIKey
  apiKey:
    secretRef:
      name: vercel-secret